
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>График приёма таблеток</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    h1 {
      text-align: center;
    }
    .day {
      margin: 10px 0;
    }
    .day h3 {
      margin-bottom: 5px;
    }
    .pill {
      display: inline-block;
      margin: 3px;
      padding: 10px;
      border: 1px solid #999;
      border-radius: 5px;
      background: white;
      cursor: pointer;
      white-space: pre-line;
    }
    .pill.taken {
      background-color: #90ee90;
    }
  </style>
</head>
<body>
  <h1>График приёма таблеток</h1>
  <div id="container"></div>
  <script>
    const plan = [{"days": [1, 2, 3], "interval": 2, "count": 8}, {"days": [4, 5, 6, 7, 8, 9, 10, 11, 12], "interval": 2.5, "count": 7}, {"days": [13, 14, 15, 16], "interval": 3, "count": 6}, {"days": [17, 18, 19, 20], "interval": 5, "count": 3}, {"days": [21, 22, 23, 24, 25], "interval": null, "count": 1, "as_needed": true}];

    function formatTime(hours) {
      const h = Math.floor(hours);
      const m = Math.round((hours - h) * 60);
      return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
    }

    function saveState(id, taken) {
      localStorage.setItem(id, taken ? '1' : '0');
    }

    function loadState(id) {
      return localStorage.getItem(id) === '1';
    }

    const container = document.getElementById('container');

    plan.forEach(block => {
      block.days.forEach(function(day) {
        const div = document.createElement('div');
        div.className = 'day';
        const title = document.createElement('h3');
        title.textContent = "День " + day + (block.as_needed ? " — по самочувствию" : " — каждые " + block.interval + " ч");
        div.appendChild(title);

        if (block.as_needed) {
          const pill = document.createElement('div');
          pill.className = 'pill';
          pill.textContent = "Таблетка 1";
          const id = "d" + day + "_t1";
          if (loadState(id)) pill.classList.add('taken');
          pill.onclick = () => {
            pill.classList.toggle('taken');
            saveState(id, pill.classList.contains('taken'));
          };
          div.appendChild(pill);
        } else {
          for (let i = 0; i < block.count; i++) {
            const pill = document.createElement('div');
            const time = formatTime(8 + i * block.interval);
            pill.className = 'pill';
            pill.textContent = "Таблетка " + (i+1) + "\n" + time;
            const id = "d" + day + "_t" + (i+1);
            if (loadState(id)) pill.classList.add('taken');
            pill.onclick = () => {
              pill.classList.toggle('taken');
              saveState(id, pill.classList.contains('taken'));
            };
            div.appendChild(pill);
          }
        }

        container.appendChild(div);
      });
    });
  </script>
</body>
</html>

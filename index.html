<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>График приёма таблеток</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f4; padding: 20px; }
        h2 { margin-top: 30px; }
        .day { margin-bottom: 20px; }
        .pill-row { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
        .pill { padding: 10px; background: #fff; border: 1px solid #ccc; border-radius: 5px; cursor: pointer; }
        .pill.taken { background-color: #b2f2bb; }
    </style>
</head>
<body>
    <h1>График приёма таблеток</h1>
    <div id="schedule"></div>

    <script>
        const plan = [
            { days: [1,2,3], every: 2, times: 6 },
            { days: [4,5,6,7,8,9,10,11], every: 2.5, times: 5 },
            { days: [12,13,14,15,16], every: 3, times: 4 },
            { days: [17,18,19,20], every: 5, times: 3 },
            { days: [21,22,23,24,25], every: 0, times: 1, as_needed: true }
        ];

        const startTime = 8;

        const container = document.getElementById('schedule');
        const state = JSON.parse(localStorage.getItem('pill-tracker') || '{}');

        function createPill(day, index, time) {
            const key = `d${day}-p${index}`;
            const btn = document.createElement('div');
            btn.className = 'pill' + (state[key] ? ' taken' : '');
            btn.textContent = `Таблетка ${index + 1}
${time}:00`;
            btn.onclick = () => {
                state[key] = !state[key];
                localStorage.setItem('pill-tracker', JSON.stringify(state));
                btn.classList.toggle('taken');
            };
            return btn;
        }

        function renderSchedule() {
            plan.forEach(({ days, every, times, as_needed }) => {
                days.forEach(day => {
                    const dayBlock = document.createElement('div');
                    dayBlock.className = 'day';
                    const title = document.createElement('h2');
                    title.textContent = `День ${day} — ${as_needed ? 'по самочувствию' : `каждые ${every} ч`}`;
                    const row = document.createElement('div');
                    row.className = 'pill-row';

                    for (let i = 0; i < times; i++) {
                        const hour = startTime + (as_needed ? 0 : Math.floor(i * every));
                        row.appendChild(createPill(day, i, hour));
                    }

                    dayBlock.appendChild(title);
                    dayBlock.appendChild(row);
                    container.appendChild(dayBlock);
                });
            });
        }

        renderSchedule();
    </script>
</body>
</html>
